CREATE TABLE user (
	userid		 BIGINT,
	username	 VARCHAR(128) UNIQUE NOT NULL,
	firstname	 VARCHAR(64) NOT NULL,
	lastname	 VARCHAR(64),
	email		 VARCHAR(128) UNIQUE NOT NULL,
	phonenumber	 VARCHAR(32) UNIQUE NOT NULL,
	address	 VARCHAR(256) NOT NULL,
	birthdate	 DATE NOT NULL,
	wallet		 FLOAT(32) NOT NULL DEFAULT 0,
	passwordhash	 VARCHAR(512) UNIQUE NOT NULL,
	bantimestamp	 TIMESTAMP,
	createtimestamp TIMESTAMP NOT NULL,
	updatetimestamp TIMESTAMP NOT NULL,
	deletetimestamp TIMESTAMP,
	role_roleid	 BIGINT NOT NULL,
	PRIMARY KEY(userid)
);

CREATE TABLE role (
	roleid	 BIGINT,
	rolename	 VARCHAR(128) UNIQUE NOT NULL,
	description VARCHAR(1024),
	PRIMARY KEY(roleid)
);

CREATE TABLE item (
	itemid		 BIGINT,
	ean		 VARCHAR(13) UNIQUE NOT NULL,
	itemname	 VARCHAR(128) NOT NULL,
	description	 VARCHAR(1024),
	quantity	 SMALLINT NOT NULL DEFAULT 1,
	origin		 VARCHAR(128) NOT NULL,
	createtimestamp TIMESTAMP NOT NULL,
	updatetimestamp TIMESTAMP NOT NULL,
	deletetimestamp TIMESTAMP,
	user_userid	 BIGINT NOT NULL,
	PRIMARY KEY(itemid)
);

CREATE TABLE category (
	categoryid	 BIGINT,
	categoryname VARCHAR(128) UNIQUE NOT NULL,
	description	 VARCHAR(1024),
	PRIMARY KEY(categoryid)
);

CREATE TABLE auction (
	auctionid		 BIGINT,
	auctionname	 VARCHAR(128) NOT NULL,
	description	 VARCHAR(1024),
	currentbidvaue	 FLOAT(32) NOT NULL,
	initalvalue	 FLOAT(32) NOT NULL,
	currentstate	 INTEGER NOT NULL DEFAULT 0,
	starttimestamp	 TIMESTAMP NOT NULL,
	expirationtimestamp TIMESTAMP NOT NULL,
	endtimestamp	 TIMESTAMP NOT NULL,
	createtimestamp	 TIMESTAMP NOT NULL,
	updatetimestamp	 TIMESTAMP NOT NULL,
	deletetimestamp	 TIMESTAMP,
	user_userid	 BIGINT NOT NULL,
	item_itemid	 BIGINT NOT NULL,
	PRIMARY KEY(auctionid)
);

CREATE TABLE bid (
	bidid		 BIGINT,
	description	 VARCHAR(1024),
	amount		 FLOAT(32) NOT NULL,
	createtimestamp	 TIMESTAMP NOT NULL,
	auction_auctionid BIGINT NOT NULL,
	user_userid	 BIGINT NOT NULL,
	PRIMARY KEY(bidid)
);

CREATE TABLE comment (
	commentid	 BIGINT,
	text		 VARCHAR(1024) NOT NULL,
	createtimestamp	 TIMESTAMP NOT NULL,
	updatetimestamp	 TIMESTAMP NOT NULL,
	deletetimestamp	 TIMESTAMP,
	user_userid	 BIGINT NOT NULL,
	auction_auctionid BIGINT NOT NULL,
	PRIMARY KEY(commentid)
);

CREATE TABLE notification (
	notificationid	 BIGINT,
	notificationtype SMALLINT NOT NULL,
	notificationname VARCHAR(128) NOT NULL,
	seen		 BOOL NOT NULL DEFAULT 0,
	description	 VARCHAR(1024),
	createtimestamp	 TIMESTAMP NOT NULL,
	deletetimestamp	 TIMESTAMP,
	user_userid	 BIGINT NOT NULL,
	PRIMARY KEY(notificationid)
);

CREATE TABLE auctionedithistory (
	auctionedithistoryid BIGINT,
	version		 SMALLINT DEFAULT 0,
	auctionname		 VARCHAR(128) NOT NULL,
	description		 VARCHAR(1024),
	edittimestamp	 TIMESTAMP NOT NULL,
	auction_auctionid	 BIGINT NOT NULL,
	PRIMARY KEY(auctionedithistoryid)
);

CREATE TABLE user_auction (
	user_userid	 BIGINT,
	auction_auctionid BIGINT,
	PRIMARY KEY(user_userid,auction_auctionid)
);

CREATE TABLE item_category (
	item_itemid	 BIGINT,
	category_categoryid BIGINT,
	PRIMARY KEY(item_itemid,category_categoryid)
);

ALTER TABLE user ADD CONSTRAINT user_fk1 FOREIGN KEY (role_roleid) REFERENCES role(roleid);
ALTER TABLE item ADD CONSTRAINT item_fk1 FOREIGN KEY (user_userid) REFERENCES user(userid);
ALTER TABLE auction ADD CONSTRAINT auction_fk1 FOREIGN KEY (user_userid) REFERENCES user(userid);
ALTER TABLE auction ADD CONSTRAINT auction_fk2 FOREIGN KEY (item_itemid) REFERENCES item(itemid);
ALTER TABLE bid ADD CONSTRAINT bid_fk1 FOREIGN KEY (auction_auctionid) REFERENCES auction(auctionid);
ALTER TABLE bid ADD CONSTRAINT bid_fk2 FOREIGN KEY (user_userid) REFERENCES user(userid);
ALTER TABLE comment ADD CONSTRAINT comment_fk1 FOREIGN KEY (user_userid) REFERENCES user(userid);
ALTER TABLE comment ADD CONSTRAINT comment_fk2 FOREIGN KEY (auction_auctionid) REFERENCES auction(auctionid);
ALTER TABLE notification ADD CONSTRAINT notification_fk1 FOREIGN KEY (user_userid) REFERENCES user(userid);
ALTER TABLE auctionedithistory ADD CONSTRAINT auctionedithistory_fk1 FOREIGN KEY (auction_auctionid) REFERENCES auction(auctionid);
ALTER TABLE user_auction ADD CONSTRAINT user_auction_fk1 FOREIGN KEY (user_userid) REFERENCES user(userid);
ALTER TABLE user_auction ADD CONSTRAINT user_auction_fk2 FOREIGN KEY (auction_auctionid) REFERENCES auction(auctionid);
ALTER TABLE item_category ADD CONSTRAINT item_category_fk1 FOREIGN KEY (item_itemid) REFERENCES item(itemid);
ALTER TABLE item_category ADD CONSTRAINT item_category_fk2 FOREIGN KEY (category_categoryid) REFERENCES category(categoryid);

